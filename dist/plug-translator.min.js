"use strict";void 0!==window.pt&&window.pt.kill(),function(t){window.pt={events:{doubleClickHandler:function(e){var n=this;if(/message|mention|emote/i.test(e.currentTarget.className)){var i=t(e.currentTarget);if(i.attr("translated"))return window.pt.utils.restoreOriginalMessage(i);var r=i.find(".text").html(),o=window.pt.utils.stripNonText(r.replace(/<br\s*\/*>/gi,"\n"));return i.attr("translated",!0),i.data({raw_html:r}),window.pt.utils.translate(encodeURIComponent(o)).then(function(t){t=t.filter(function(t){return t&&t.length});var e=t[0].map(function(t){return t[0]}).join("");e.replace(/\n/g,"<br>");i.find(".text").html(e)}).catch(function(t){return window.pt.utils.failedTranslation(n)})}}},utils:{restoreOriginalMessage:function(t){var e=t.data("raw_html");t.find(".text").html(e),t.attr("translated",null),t.data("raw_html",null)},stripNonText:function(t){for(var e=t.match(/<[^>]*>/gi)||[],n=0;n<e.length;n++){var i=t.indexOf(e[n]);t=t.split(""),t.splice(i,e[n].length),t=t.join("")}for(var r=window.API.getUsers().map(function(t){return"@"+t.username}),o=0;o<r.length;o++){var a=t.indexOf(r[o]);-1!==a&&(t=t.split(""),t.splice(a,r[o].length),t=t.join(""))}return t},translate:function(e){return new Promise(function(n,i){t.get("https://translate.googleapis.com/translate_a/single?client=gtx&dt=t&sl=auto&tl=en&q="+e).done(function(t){return n(t)}).fail(i)})},failedTranslation:function(e){clearTimeout(window.pt.tooltipHide),window.pt.tooltipHide=setTimeout(function(){return window.pt.EventsModule.trigger("tooltip:hide")},3e3),window.pt.EventsModule.trigger("tooltip:show","Translation failed.",t(e))}},init:function(){if(void 0===window.jQuery)return setTimeout(window.pt.init,200);t("#chat-messages").on("dblclick",".cm",this.events.doubleClickHandler),t("head").append('<style id="plug-translator-css">.cm[translated="true"] .from .un:after{background-color: #313131;content: "TRANSLATED";border-radius: 3px;margin-left: 5px;font-size: 9px;padding: 0 4px;color: #ccc;position: relative;bottom: 1px;cursor: default}</style>'),this.require=window.require.s.contexts._.defined;for(var e in this.require){var n=this.require[e];n&&(n._events&&n._events["chat:receive"]&&(this.EventsModule=n))}var i="Double click a chat message to translate. Double click it again to revert.";API.chatLog(i),this.startupTextTimeout=setTimeout(function(){return t(".cm.log:contains("+i+")").remove()},1e4)},kill:function(){this.EventsModule.trigger("tooltip:hide"),t("#chat-messages").off("dblclick",".cm",this.events.doubleClickHandler),t("#plug-translator-css").remove(),delete window.pt}},window.pt.init()}(window.jQuery);